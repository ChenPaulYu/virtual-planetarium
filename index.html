<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>virtual-planetarium</title>
    <script src = "./lib/virtualSky/stuquery.js"></script>
    <script src = "./lib/virtualSky/virtualsky.js" type="text/javascript"></script>
    <script src="./lib/leapMotion/leap-0.6.4.js"></script>

    <script>


    S(document).ready(function() {
            var ra = 83;
            var dec = 60;
            var fov = 50;
            var planetarium = S.virtualsky({
                    'id': 'starmap',
                    'projection': 'gnomic',
                    'ra': ra,
                    'dec': dec,
                    'ground': false,
                    'keyboard': true,
                    'gradient': true,
                    'cardinalpoints': false,
                    'showposition': true,
                    'fov': fov,
                    'constellations':true,
                    // 'fullscreen':true
            });

            planetarium.addPointer({
                'ra':83.8220792,
                'dec':-5.3911111,
                'label':'Orion Nebula',
                'img':'http://server7.sky-map.org/imgcut?survey=DSS2&w=128&h=128&ra=5.58813861333333&de=-5.3911111&angle=1.25&output=PNG',
                'url':'http://simbad.u-strasbg.fr/simbad/sim-id?Ident=M42',
                'credit':'Wikisky',
                colour:'rgb(255,220,220)'
            });

        var canvas = document.getElementById('starmap_inner'),
        context = canvas.getContext('2d');

        // make_base();

        // function make_base() {
        //     base_image = new Image();
        //     base_image.src = './picture/pic.png'
        //     console.log(base_image)
        //     base_image.onload = function () {
        //         context.globalAlpha = 0.4;
        //         // context.rotate(10 * Math.PI / 180);
        //         context.drawImage(base_image, 507.29286631014446+100,265.59896883405065-50);
        //         context.resetTransform();

        //     }
        // }

        // context.restore()

            
            

        var controller = Leap.loop({enableGestures: true}, function(frame){
            if (frame.gestures.length > 0) {
                for (var i = 0; i < frame.gestures.length; i++) {
                var gesture = frame.gestures[i];
                if(gesture.type == "swipe") {
                    console.log('swipe')
                    //Classify swipe as either horizontal or vertical
                    var isHorizontal = Math.abs(gesture.direction[0]) > Math.abs(gesture.direction[1]);
                    //Classify as right-left or up-down
                    if(isHorizontal){

                        if(gesture.direction[0] > 0){
                            // right
                            ra += 1
                            fov -= 0.1
                            console.log('right')
                           planetarium.panTo(56.8690917, 24.1053111, 1000)
                        } else {
                            // left
                            console.log('left')
                            ra -= 1
                            fov += 0.1
                           planetarium.panTo(83.6330833, 22.0145000, 1000)
                        }
                    } else { //vertical
                        if(gesture.direction[1] > 0){
                            // up
                            dec += 1
                            fov -= 0.1
                            console.log('up')
                           planetarium.panTo(229.6384167, 2.0810278, 1000)

                        } else {
                            // down
                            dec -= 1
                            fov += 0.1
                            console.log('down')
                           planetarium.panTo(268.4625000, 2.0810278, 1000)
                        }                  
                    }
                    // console.log(ra,dec)
                    // planetarium.fov = fov
                    // planetarium.panTo(ra, dec, 0)
                }
                }
            }
        });

    });


   
    </script>
</head>
<body>
    <div id="starmap" style="height:900px;width: 100%;"></div>

</body>
</html>