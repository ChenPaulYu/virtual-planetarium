<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>virtual-planetarium</title>
    <script src = "./lib/virtualSky/stuquery.js"></script>
    <script src = "./lib/virtualSky/virtualsky.js" type="text/javascript"></script>
    <!-- <script src="./lib/leapMotion/leap-0.6.4.js"></script> -->
    <script src="./lib/leapMotion/leap.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="./lib/leaptrainer.min.js"></script>


    <style>
        img {
            /* border: solid 5px black; */
        }
    </style>
    <script>    
    var dec_ra = [
        { 
            "name": "UMa",
            "ra": 160.9905542,
            "dec": 55.0190889,
        },{
            "name": "UMi",
            "ra": 254.2877083,
            "dec": 82,
        },{
            "name": "Her",
            "ra": 255.3025000,
            "dec": 30.6599417,
        },{
            "name": "Crv",
            "ra": 194.1820667,
            "dec": -20.756700,
        },{
            "name": "Sun",
            "ra": 0,
            "dec": 0,
        },{
            "name": "Aur",
            "ra": 92.2250000,
            "dec": 40.8651694,
        },{
            "name": "Vir",
            "ra": 202.4695750,
            "dec": 0.0791694,
        },{
            "name": "Oph",
            "ra": 268.4625000,
            "dec": 0.0791694,            
        },{
            "name": "Leo",
            "ra": 179.3999333,
            "dec": 15.7834611,
        }

    ]
    S(document).ready(function() {
            var ra  = dec_ra[4].ra;
            var dec = dec_ra[4].dec;
            var fov = 60;
            var planetarium = S.virtualsky({
                    'id': 'starmap',
                    'projection': 'gnomic',
                    'ra': ra,
                    'dec': dec,
                    'ground': false,
                    'keyboard': true,
                    'gradient': true,
                    'cardinalpoints': false,
                    'showposition': true,
                    'fov': fov,
                    'constellations':true,
                    // 'fullscreen':true
            });

            planetarium.addPointer({
                'ra':83.8220792,
                'dec':-5.3911111,
                'label':'Orion Nebula',
                'img':'http://server7.sky-map.org/imgcut?survey=DSS2&w=128&h=128&ra=5.58813861333333&de=-5.3911111&angle=1.25&output=PNG',
                'url':'http://simbad.u-strasbg.fr/simbad/sim-id?Ident=M42',
                'credit':'Wikisky',
                colour:'rgb(255,220,220)'
            });

        var canvas = document.getElementById('starmap_inner'),
        context = canvas.getContext('2d');
        // var trainer = new LeapTrainer.Controller();
        // trainer.fromJSON('{"name":"CLICK","pose":false,"data":[[{"x":0.12391365937543221,"y":0.12811019539909319,"z":0.3676427512661459,"stroke":1},{"x":-0.03322586491157528,"y":0.39553093479886914,"z":0.09102851321939703,"stroke":1},{"x":-0.09611979429550122,"y":0.3885637216026383,"z":-0.06993772971393891,"stroke":1},{"x":0.0546596734247347,"y":0.18169531873782274,"z":0.21350713943359012,"stroke":1},{"x":0.03873245099944163,"y":0.183116186526465,"z":0.16933916287772643,"stroke":1},{"x":-0.12368624015115824,"y":0.24813172808039563,"z":-0.18932991748003253,"stroke":1},{"x":-0.027871307691098607,"y":0.11802815261912503,"z":-0.01983515074006531,"stroke":1},{"x":0.12344300714078575,"y":0.029590274726791654,"z":0.28338122934940124,"stroke":1},{"x":-0.03282845213562113,"y":0.015183817738940952,"z":-0.08704783491978474,"stroke":1},{"x":-0.09409699320764839,"y":-0.06646285175523858,"z":-0.25595865988153393,"stroke":1},{"x":0.061063364208163315,"y":-0.10240549070903604,"z":0.07616513601313357,"stroke":1},{"x":0.0647546767863401,"y":-0.1408630160827446,"z":0.06143785345092645,"stroke":1},{"x":-0.0837661374606703,"y":-0.2564602666834912,"z":-0.2841362158373485,"stroke":1},{"x":-0.016945085467931623,"y":-0.2838989710084185,"z":-0.15040293422085793,"stroke":1},{"x":0.1339380700377661,"y":-0.23339066879008252,"z":0.15318729856927749,"stroke":1},{"x":-0.09196502665145881,"y":-0.6044690652011309,"z":-0.35904064138603775,"stroke":1}]]}');
        // trainer.fromJSON('{"name":"CATCH","pose":false,"data":[[{"x":0.15147775900046692,"y":-0.2710339419076323,"z":0.4133944862470852,"stroke":1},{"x":-0.09480469228439146,"y":0.0903806205901061,"z":-0.4385583734602118,"stroke":1},{"x":0.008498198293513226,"y":-0.1967419945144826,"z":0.4527860415279713,"stroke":1},{"x":0.1547242710939681,"y":-0.25629936170461637,"z":0.48594469598302514,"stroke":1},{"x":0.05666265773411994,"y":-0.20033459979678617,"z":0.44877616027271305,"stroke":1},{"x":0.06169740273682736,"y":0.13541549554724186,"z":-0.4499086409325025,"stroke":1},{"x":-0.00004887104055384395,"y":-0.11912001321512009,"z":0.22823145251971622,"stroke":1},{"x":-0.12875180656758373,"y":0.05678565254826634,"z":-0.08558305852296638,"stroke":1},{"x":-0.14899743574289206,"y":0.09382142418292322,"z":-0.13758687123653468,"stroke":1},{"x":-0.01729182549045677,"y":0.2560079537925196,"z":-0.5140553040169749,"stroke":1},{"x":-0.029774833819708066,"y":-0.1053254014597802,"z":0.17643907170367967,"stroke":1},{"x":0.048955216151720965,"y":0.04380474636008874,"z":-0.1581576113108032,"stroke":1},{"x":0.02458213496363071,"y":0.017385795591652486,"z":-0.10176826510574966,"stroke":1},{"x":-0.085567149286711,"y":0.18226388135358512,"z":-0.14978031828046873,"stroke":1},{"x":-0.02467269894288543,"y":-0.11456214915888657,"z":0.2211818664365942,"stroke":1},{"x":0.0730195090667135,"y":0.25275167079709415,"z":-0.33046512804878553,"stroke":1},{"x":0.12501496060727305,"y":0.17342936702812306,"z":-0.22085083977288433,"stroke":1},{"x":-0.04541755081681541,"y":-0.08361240299705316,"z":0.14412851260667825,"stroke":1},{"x":-0.06927659950450782,"y":0.11746836222748286,"z":-0.07686437378310035,"stroke":1},{"x":-0.06002864615172818,"y":-0.0724851052647251,"z":0.09269649717351791,"stroke":1}]]}')
        // trainer.on('CLICK',function() {
        //     console.log('click')
		// 	planetarium.fov = 35;
        // })
        // trainer.on('CATCH',function() {
        //     console.log('CATCH')
		// 	planetarium.fov = 60;
		// })
        var bounce  = false;
        var controller = Leap.loop({enableGestures: true}, function(frame){
            if (frame.gestures.length > 0) {
                for (var i = 0; i < frame.gestures.length; i++) {
                    var gesture = frame.gestures[i];
                    // console.log(gesture.type);
                    if(gesture.type == "swipe" && bounce == false) {
                        console.log('swipe')
                        bounce = true;
                        //Classify swipe as either horizontal or vertical
                        var isHorizontal = Math.abs(gesture.direction[0]) > Math.abs(gesture.direction[1]);
                        //Classify as right-left or up-down
                        if(isHorizontal){
                            if(gesture.direction[0] > 0){
                                // right
                                console.log('right')
        
                                if(planetarium.target != 8) {
                                    planetarium.target += 1  
                                }
                            } else {
                                // left
                                console.log('left')
                                if(planetarium.target != 0) {
                                    planetarium.target -= 1  
                                }
                            //    planetarium.panTo(83.6330833, 22.0145000, 1000)
                            }
                        } else { //vertical
                            if(gesture.direction[1] > 0){
                                // up
                                if(planetarium.target-3 >= 0) {
                                    planetarium.target -= 3  
                                }
                                console.log('up')
                            //    planetarium.panTo(229.6384167, 2.0810278, 1000)

                            } else {
                                // down
                                if(planetarium.target+3 <= 8) {
                                    planetarium.target +=3;  
                                }
                            console.log('down')
                            //    planetarium.panTo(268.4625000, 2.0810278, 1000)
                            }                  
                        }
                        // planetarium.fov = fov
                        planetarium.panTo(dec_ra[planetarium.target].ra, dec_ra[planetarium.target].dec, 0)
                        // setTimeout(function(){
                        //     console.log(planetarium.target)
                        // },500)
                        
                        
                    } else if(gesture.type == 'circle'){
                        var pointableID = gesture.pointableIds[0];
                        var direction = frame.pointable(pointableID).direction;
                        var dotProduct = Leap.vec3.dot(direction, gesture.normal);

                        if (dotProduct > 0) {
                            if(planetarium.fov > 35) {
                                planetarium.fov -= 0.1
                                planetarium.changeFOV(0).draw()
                            }
                        }else {
                                if(planetarium.fov < 60) {
                                planetarium.fov += 0.1
                                planetarium.changeFOV(0).draw()
                            }          
                        }
                        console.log('circle')
                        console.log(planetarium.fov)
                       
                    }
                }
                
            }else {
                bounce = false
            }
        
        });

    

    });


   
    </script>
</head>
<body>
    <div id="starmap" style="height:900px;width: 100%;"></div>

</body>
</html>